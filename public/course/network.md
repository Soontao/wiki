# 计算机网络

## 第一章 概要

#### 定义

* **计算机网络**：
  两台以上具有独立操作系统的计算机通过某些介质连接成的相互共享软硬件资源的集合体。
  提供连通性和**共享**功能。

* **协议** :
  定义了两个或多个通信实体间所交换报文的格式和次序，以及在报文发送和/或接收或者其他事件方面所采取的行动（响应）。

  协议的基本要素：**语法、语义和同步**


#### 分组交换网络

延迟分为四部分

* 节点处理时延
  检查错误位 选择输出链路

* 排队时延
  等待被发送到输出链路上的时间 

* 传输时延
  发送分组比特流的时间 = L/R

* 传播时延
  d = 物理链路的长度
  s = 介质的信号传播速度 (~2x10^8 m/sec)
  传播延迟 = d/s


#### TCP/IP 
- 应用层application: 支持网络应用，报文传送

  FTP, SMTP, STTP …

- 传输层transport: 

    主机进程间数据段传送
  TCP, UDP
- 网络层network: 

    主机(源目标节点)间分组传送
  主要是IP协议, 路由协议 …
- 链路层link: 

    相邻网络节点间的数据帧传送
  PPP, Ethernet(以太网) …
- 物理层physical: 

    物理介质上的比特传送


## 第二章 应用层

#### 安全TCP套接字层SSL

安全套接字层为网络通信提供安全及数据完整性的一种**安全协议**。
主要是在运输层对网络连接进行加密，无法查看端口号、数据等信息。
目前广泛应用在web浏览器与服务器之间的身份认证、加密数据传输等。

#### Web应用和HTTP协议

常用术语

* 网页（Web页，或称文档）
  由许多对象组成。 
  多数网页由单个基本HTML文件和若干个所引用的对象构成
* 对象
  就是文件，可以是HTML文件,JPEG图像,Java applet, 音频文件…
  每个对象被一个URL(Uniform Resource Locator统一资源定位符)寻址




#### HTTP 超文本传输协议 -- hypertext transfer protocol



* RTT Round-Trip Time -- 1个小分组从客户主机到服务器再到客户主机所花费的时间
* 响应时间 2RTT+HTML传输时间


#### Web 缓存

所有HTTP请求指向缓存

* 对象在缓存中：缓存器返回对象
* 否则缓存器向起始服务器发出请求，接收对象后转发给客户机

为什么需要Web缓存器?

- 减少对客户机请求的响应时间
- 减少内部网络与接入链路上的通信量
- 能从整体上大大降低因特网上的Web流量



#### 文件传输协议FTP 

* 控制连接端口 21 
  **带外发送控制信息**
* 数据连接端口 20
  传输文件到远程主机/从远程主机下载文件



#### 电子邮件

* SMTP
  端口 25，握手-传输-结束 三个阶段，邮件消息必须是7-bit ASCII
  服务器间传递邮件
* POP3
  无状态

* IMAP
  跟踪用户会话的状态信息
  保存所有邮件消息在服务器
  允许用户在服务器的各文件夹中管理邮件消息



#### DNS的功能和查询流程

1. 主机名到IP地址的转换
2. 主机别名（虚拟主机）
3. 一个主机可以有一个规范主机名和多个主机别名
4. 邮件服务器别名
5. 由DNS实现的负载均衡

查询方式

* 递归查询
  交给被查询的名字服务器

* 迭代查询
  可以被查询的名字服务器的IP地址



## 第三章 传输层


在两个不同的主机上运行的应用程序之间提供 逻辑通信

#### 流水线


流水线: 发送方允许发送**多个“在路上的”**,还没有确认的报文

* 回退N步 GBN
  只确认自己接收到的最后一个正确分组

* 选择重传（信道利用率高）
  接收方分别确认已经收到的分组
  发送者只重发没有收到确认的分组
  每个未被确认的报文都有一个定时器

#### UDP特点

* 不可靠，无连接，端到端，全双工
* 报文首部8个字节4个字段

* UDP伪首部，包含32位源IP地址，32位目的IP地址，8位协议，16位UDP长度。
* 在计算检验和时，临时把“伪首部”和UDP用户数据报连接在一起。伪首部仅仅是为了计算检验和。并不发送。

#### 校验和

1. 16位带回卷加和
2. 按位变反
3. 检验的时候收到的数据和校验码一起加和变反，如果为0就没有错误

#### TCP

* 面向连接、可靠数据传输、流量控制、拥塞控制

##### TCP报文

* 20字节的固定首部

* ACK确认的是下一个希望接受的序号

##### 连接管理 -- 超时计算

```
EstimatedRTT
= (1- a) * EstimatedRTT + a * SampleRTT
```

典型的: a = 0.125


```
DevRTT
= (1-b) * DevRTT+b * |SampleRTT-EstimatedRTT|
```

典型的: b = 0.25



1. 初始时TimeoutInterval设置为1秒
2. 第一个样本RTT获得后，EstimatedRTT = SampleRTT，
3. DevRTT = SampleRTT / 2 ， 
4. TimeoutInterval = EstimatedRTT + max (G, K \* DevRTT) （K=4，G是用户设置的时间粒度）



##### 可靠传输

* **快速重传** -- 根据重复确认报文重传
  3次重复确认（即4次相同的确认），启动快速重传 --  在定时器超时之前重发丢失的报文段

##### 流量控制

* 控制接收窗口
  发送方限制没有确认的数据不超过接收窗口

##### 拥塞控制



* 发送方如何感知拥塞 ?
  丢失事件 = 超时或者 3 个重复的acks
  TCP 发送方在丢失事件发生后降低发送速率(CongWin)


##### TCP 慢启动

* 当连接开始的时候以**指数方式增加速率**，直到第一个丢失事件（三个重复ACK）发生
  3个重复的ACKs表明网络具有传输一些数据段的能力
* 三个重复的确认后：CongWin**减半**，窗口**线性**增长
* **超时事件后，TCP重新进入慢启动过程** -- 将拥塞窗口设置为1

## 第四章 网络层

重要功能

* 转发
* 选路
* 连接建立

#### IP协议

- IP报文
- IP编址
  网络号和主机号两部分组成。
  标识一个特定的网络（一条链路接口）和网络中的主机或路由器。
  按照因特网的观点，用集线器或交换机连接起来的若干个局域网仍为**一个网络**，因此这些**局域网具有同样的网络号**。
  IP地址中，所有分配到网络号的网络都是平等的。

- 无分类编址CIDR划分子网
  网络前缀 | 主机号
  使用斜线记法，又称为CIDR记法来区分网络前缀和主机号，即在IP地址后面加上一个斜线“/”，斜线后面用一个数字指定网络前缀的长度。
- NAT网络地址转换
  外出的分组: 替换每个外出的分组的 (源IP 地址, 端口号) 为 (NAT IP 地址, 新端口号) 
  远程客户/服务器用(NAT IP地址, 新端口号)作为目的地来响应。
  记住 (在NAT转换表中) 每个(源IP 地址, 端口号)到 (NAT IP地址, 新端口号) 转换配对
  进来的分组: 对每个进来的分组，用保存在NAT表中的对应的(源IP 地址, 端口号) 替换分组中的目的域 (NAT IP 地址, 新端口号）

- IPv6协议：地址空间
  2^128

#### 选路算法



* 链接状态选路算法 -- Dijkstra算法
  1. 计算从一个节点(源节点)到其他所有节点的最小开销路径
  2. 重复(迭代): K次迭代以后, 得知到其它K个目的地的最小开销路径


* 距离向量选路算法


* 层次选路



#### RIP
**距离向量算法**
包含在 软件1982年发布的BSD-UNIX 版本中。
距离衡量: 跳数 (max = 15 hops)
距离向量: 每隔30秒,通过响应报文在邻居间进行交换(也被称为RIP通告, advertisement)
每个通告: 包含了多达25个AS内的目的子网的列表

#### OSPF
“open”: “开放”: 公用的
用**链路状态算法** 
分发LS 分组
每个节点具有拓扑图
路由计算使用 Dijkstra算法
每个router都广播OSPF通告，OSPF通告里为每个邻居路由器设一个表项（记录每个邻居的链路特征和费用）。
通告会散布到 整个 自治系统 (通过洪泛法) 
OSPF信息直接通过 IP传输 (不是 TCP 或 UDP）

## 第五章 数据链路层

##### 链路层提供的服务
- 成帧
  封装成帧
- 链路访问(接入)
- 差错检测和纠正
- 可靠交付(性能开销，主要用于无线链路，类似于运输层协议)

##### 差错检测技术
- 奇偶校验、二位奇偶校验能够纠正1位错误
- CRC循环冗余校验

##### 链路类型：点对点和共享

##### 共享介质使用多址访问技术

* 信道划分
* 随机访问
* 轮转

##### 链路层编址

* MAC地址
* ARP协议
* DHCP协议

##### DHCP协议


##### 以太网技术

- 连接方式：星型拓扑结构

- 以太网技术定义链路层和物理层的实现方式

- 帧格式

- 以太网提供无连接、不可靠的服务

- 共享式以太网采用CSMA/CD介质访问控制技术

- 物理层采用曼彻斯特编码
中间跳变

- 连接设备使用集线器和交换机

- 交换机的工作原理
  自学习机制

